<!DOCTYPE html>

<html lang="it">
    <head>
        <title>Reattore Ark - marlev.it</title>
        <link rel="stylesheet" href="index.css"/>
        
        <meta charset="UTF-8"/>
        <meta name="description" content="Acquista una replica di un reattore Ark personalizzabile su marlev.it"/>
        <meta name="author" content="Alessandro Iop"/>
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
        
        <script src="lib/three.min.js"></script>
		<script src="lib/stats.min.js"></script>
		<script src="lib/OrbitControls.js"></script>
		<script src='lib/dat.gui.min.js'></script>
		<script src='lib/OBJLoader.js'></script>
    </head>
    <body>
		<header>
			<a href="#"><img src="images/MarlevLogo.png"/></a>
		</header>
		<nav id="nav">
			<!-- menu -->
			<a href="#"><img src="images/noun_1686738_cc.svg">Home</a>
			<a href="#"><img src="images/noun_1686727_cc.svg">Carrello</a>
			<a href="#"><img src="images/noun_1686725_cc.svg">I prodotti</a>
			<div class="dropdown">
				<button class="dropbtn"><img src="images/noun_1686757_cc.svg">Area personale</button>
				<div class="dropdown-content">
					<a href="#">Log In / Sign In</a>
					<a href="#">Il mio account</a>
					<a href="#">I miei ordini</a>
					<a href="#">Privacy</a>
				</div>
			</div>
			
			<script type="text/javascript">                
				// When the user scrolls the page, execute myFunction
				window.onscroll = function() {
					myFunction()
				};
				
				var nav = document.getElementById("nav");
				var sticky = nav.offsetTop;

				// Add the sticky class to the header when you reach its scroll position. Remove "sticky" when you leave the scroll position
				function myFunction() {
					
					if (window.pageYOffset >= sticky) {
						nav.classList.add("sticky");
						document.getElementById("torna_su").classList.add("sticky_footer");
					} else {
						nav.classList.remove("sticky");
						document.getElementById("torna_su").classList.remove("sticky_footer");
					}                    
				} 
			</script>
		</nav>
			
		<div id="corpo">
			<h1>Reattore Ark replica in scala 1:1</h1>
			<h2>Memorabilia del film dell'Uomo di Ferro</h2><br>
			<p id="prezzo">PREZZO: 49,99&euro;</p>
			<button>
				Aggiungi al Carrello&nbsp;
				<img src="images/noun_1686727_cc.svg">
			</button>

			<!-- shaders -->
			<script type="text/x-glsl" id="vertex">
			varying vec3 vNormal;
			varying vec3 vPosition;
			varying vec2 uVv;
			void main() {
				vec4 vPos = modelViewMatrix * vec4( position, 1.0 );
				vPosition = vPos.xyz;
				vNormal = normalMatrix * normal;
				uVv = uv;
				gl_Position = projectionMatrix * vPos;
			}
			</script>

			<script type="text/x-glsl" id="fragment">
				varying vec3 vNormal;
				varying vec3 vPosition;
				varying vec2 uVv;
				uniform vec3 pointLightPosition; // in world space
				uniform vec3 clight;
				uniform vec3 ambientLight;
				uniform vec3 cspec;
				uniform vec3 cdiff;
				uniform float roughness;
				uniform sampler2D normalMap;
				uniform sampler2D aoMap;
				uniform vec2 normalScale;
				const float PI = 3.14159;
				vec3 FSchlick(float lDoth) {
					return (cspec + (vec3(1.0)-cspec)*pow(1.0 - lDoth,5.0));
				}
				float DGGX(float nDoth, float alpha) {
					float alpha2 = alpha*alpha;
					float d = nDoth*nDoth*(alpha2-1.0)+1.0;
					return (  alpha2 / (PI*d*d));
				}
				float G1(float dotProduct, float k) {
					return (dotProduct / (dotProduct*(1.0-k) + k) );
				}
				float GSmith(float nDotv, float nDotl) {
						float k = roughness*roughness;
						return G1(nDotl,k)*G1(nDotv,k);
				}
				#extension GL_OES_standard_derivatives : enable
			vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {
				vec3 q0 = dFdx( eye_pos.xyz );
				vec3 q1 = dFdy( eye_pos.xyz );
				vec2 st0 = dFdx( uVv.st );
				vec2 st1 = dFdy( uVv.st );
				vec3 S = normalize(  q0 * st1.t - q1 * st0.t );
				vec3 T = normalize( -q0 * st1.s + q1 * st0.s );
				vec3 N =  surf_norm ;
				vec3 mapN = normalize(texture2D( normalMap, uVv ).xyz * 2.0 - 1.0);
				mapN.xy = normalScale * mapN.xy;
				mat3 tsn = mat3( S, T, N );
				return normalize( tsn * mapN );
			}
				void main() {
					vec4 lPosition = viewMatrix * vec4( pointLightPosition, 1.0 );
					vec3 l = normalize(lPosition.xyz - vPosition.xyz);
					vec3 n = perturbNormal2Arb( vPosition, normalize( vNormal ));
					vec3 v = normalize( -vPosition);
					vec3 h = normalize( v + l);
					// small quantity to prevent divisions by 0
					float nDotl = max(dot( n, l ),0.000001);
					float lDoth = max(dot( l, h ),0.000001);
					float nDoth = max(dot( n, h ),0.000001);
					float vDoth = max(dot( v, h ),0.000001);
					float nDotv = max(dot( n, v ),0.000001);
					vec3 fresnel = FSchlick(lDoth);
					vec3 BRDF = (vec3(1.0)-fresnel)*cdiff/PI + fresnel*GSmith(nDotv,nDotl)*DGGX(nDoth,roughness*roughness)/
						(4.0*nDotl*nDotv);
					vec3 outRadiance = PI* clight * nDotl * BRDF + ambientLight*cdiff*texture2D( aoMap, uVv ).xyz;
					// gamma encode the final value
					gl_FragColor = vec4(pow( outRadiance, vec3(1.0/2.2)), 1.0);
				}
			</script>

			<!-- three.js code -->

			<script>
				var renderer = new THREE.WebGLRenderer( { antialias: true } );
				var camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 1, 1000 );
				var controls = new THREE.OrbitControls( camera, renderer.domElement );
				var scene = new THREE.Scene();
				// default: white, 1.0 intensity
				var lightParameters = {
					red: 1.0,
					green: 1.0,
					blue: 1.0,
					intensity: 1.0,
				}
				var ambientLightParameters = {
					red: 0.2,
					green: 0.2,
					blue: 0.2,
					intensity: 1.0,
				}
				var textureParameters = {
					normalScale: 0.0,
				}
				var normalMap = loadTexture( "textures/normal.jpg" );
				var aoMap = loadTexture("textures/ao.jpg");
				var uniforms = {
						cspec:	{ type: "v3", value: new THREE.Vector3(0.04,0.04,0.04) },
						cdiff:	{ type: "v3", value: new THREE.Vector3(0.8,0.8,0.8) },
						roughness: {type: "f", value: 0.2},
						normalMap:	{ type: "t", value: normalMap},
							aoMap:	{ type: "t", value: aoMap},
							normalScale: {type: "v2", value: new THREE.Vector2(1,1)},
							pointLightPosition:	{ type: "v3", value: new THREE.Vector3() },
							clight:	{ type: "v3", value: new THREE.Vector3() },
							ambientLight:	{ type: "v3", value: new THREE.Vector3() },
						};
				vs = document.getElementById("vertex").textContent;
				fs = document.getElementById("fragment").textContent;
				var ourMaterial = new THREE.ShaderMaterial({ uniforms: uniforms, vertexShader: vs, fragmentShader: fs });
				var loader = new THREE.OBJLoader();
					loader.load( "models/ninjaHead_Low.obj", function ( group ) {
						geometry = group.children[ 0 ].geometry;
						geometry.center();
						mesh = new THREE.Mesh( geometry, ourMaterial );
						mesh.scale.multiplyScalar( 0.1 );
						scene.add( mesh );
					} );
				var lightMesh = new THREE.Mesh( new THREE.SphereGeometry( 1, 16, 16),
					new THREE.MeshBasicMaterial ({color: 0xffff00, wireframe:true}));
				lightMesh.position.set( 7.0, 7.0, 7.0 );
				uniforms.pointLightPosition.value = new THREE.Vector3(lightMesh.position.x,
																	lightMesh.position.y,
																	lightMesh.position.z);
				var gui;
				var stats = new Stats();
				function loadTexture(file) {
						var texture = new THREE.TextureLoader().load( file , function ( texture ) {
							texture.minFilter = THREE.LinearMipMapLinearFilter;
							texture.anisotropy = renderer.getMaxAnisotropy();
							texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
					texture.offset.set( 0, 0 );
							texture.needsUpdate = true;
							render();
						} )
						return texture;
				}
				function init() {
					renderer.setClearColor( 0xf0f0f0 );
					camera.position.set( 0, 0, 10 );
					scene.add( camera );
					scene.add(lightMesh);
					document.getElementById("corpo").appendChild( renderer.domElement );
					renderer.setPixelRatio( window.devicePixelRatio );
		/* --> */	if (window.innerWidth > 715) var size = 1/2;
					else var size = 9/10;
					renderer.setSize( window.innerWidth*size, window.innerHeight*size );
					controls.minDistance = 1;
					controls.maxDistance = 100;
					controls.enablePan = false;
					controls.update();
					window.addEventListener( 'resize', onResize, false );
				stats.domElement.style.position = 'fixed';
				stats.domElement.style.top = '50%';
				document.body.appendChild( stats.domElement );
					ourMaterial.needsUpdate = true;
				}
				function onResize() {
					renderer.setSize( window.innerWidth/2, window.innerHeight/2 );
					camera.aspect = ( window.innerWidth / window.innerHeight );
					camera.updateProjectionMatrix();
				}
				function update() {
					requestAnimationFrame( update );
					stats.update();
					render();
				}
				function render() {
					updateUniforms();
					renderer.render( scene, camera );
				}
				function clearGui() {
					if ( gui ) gui.destroy();
					gui = new dat.GUI({ autoPlace: false });
					gui.open();
					document.getElementById("corpo").appendChild(gui.domElement);
				}
				function buildGui() {
					clearGui();
					lightSettings = gui.addFolder('Light Parameters');
					lightSettings.add(lightParameters,'red').min(0).max(1).onChange( function(newVal) { render() });
					lightSettings.add(lightParameters,'green').min(0).max(1).onChange( function(newVal) { render() });
					lightSettings.add(lightParameters,'blue').min(0).max(1).onChange( function(newVal) { render() });
					lightSettings.add(lightParameters,'intensity').min(0).max(10000).onChange( function(newVal) { render() });
					ambientLightSettings = gui.addFolder('Ambient Light Parameters');
					ambientLightSettings.add(ambientLightParameters,'red').min(0).max(1).onChange( function(newVal) { render() });
					ambientLightSettings.add(ambientLightParameters,'green').min(0).max(1).onChange( function(newVal) { render() });
					ambientLightSettings.add(ambientLightParameters,'blue').min(0).max(1).onChange( function(newVal) { render() });
					ambientLightSettings.add(ambientLightParameters,'intensity').min(0).max(100).onChange( function(newVal) { render() });
					textureSettings = gui.addFolder('Texture parameters');
					textureSettings.add(textureParameters,'normalScale').min(-3).max(3).onChange( function( newVal ) {render()});
					}
				function updateUniforms() {
						uniforms.clight.value = new THREE.Vector3(
								lightParameters.red * lightParameters.intensity,
							lightParameters.green * lightParameters.intensity,
								lightParameters.blue * lightParameters.intensity);
						uniforms.ambientLight.value = new THREE.Vector3(
								ambientLightParameters.red * ambientLightParameters.intensity,
								ambientLightParameters.green * ambientLightParameters.intensity,
								ambientLightParameters.blue * ambientLightParameters.intensity);
						uniforms.normalScale.value = new THREE.Vector2( textureParameters.normalScale, textureParameters.normalScale );
				}
				init();
				buildGui();
				update();
				render();
			</script>

			<!-- PERSONALIZZAZIONE DEL PRODOTTO -->
			<form>
				<fieldset>
					<legend>Texture del reattore</legend>
					<select>
						<option onchange="updateUniforms('component', 'id_componente1')">Nome componente 1</option>
						<option onchange="updateUniforms('component', 'id_componente2')">Nome componente 2</option>
						<option onchange="updateUniforms('component', 'id_componente3')">Nome componente 3</option>
					</select><br>
					<button type="button" onclick="updateUniforms('texture', 'id_texture_legno')">Legno</button>
					<button type="button" onclick="updateUniforms('texture', 'id_texture_oro')">Oro</button>
					<button type="button" onclick="updateUniforms('texture', 'id_texture_acciaio')">Acciaio</button><br>
					<button type="button" onclick="updateUniforms('texture', 'id_texture_plastica_bianca')">Plastica bianca</button>
					<button type="button" onclick="updateUniforms('texture', 'id_texture_plastica_rossa')">Plastica rossa</button>
					<button type="button" onclick="updateUniforms('texture', 'id_texture_plastica_nera')">Plastica nera</button>
				</fieldset>

				<fieldset>
					<legend>Colore della luce</legend>
					<input type="radio" name="lighting" onclick="updateUniforms('lighting', new THREE.Vector3(1,1,1))" checked="checked">Bianco<br>
					<input type="radio" name="lighting" onclick="updateUniforms('lighting', new THREE.Vector3(1,0,0))">Rosso<br>
					<input type="radio" name="lighting" onclick="updateUniforms('lighting', new THREE.Vector3(0,1,0))">Verde<br>
					<input type="radio" name="lighting" onclick="updateUniforms('lighting', new THREE.Vector3(0,0,1))">Blu<br>
				</fieldset>

				<fieldset>
					<legend>Sfondo</legend>
					<button type="button"onclick="updateUniforms('sfondo', 'bianco')">Bianco</button>
					<button type="button" onclick="updateUniforms('sfondo', 'id_sfondo1')">Nome sfondo 1</button><br>
					<button type="button" onclick="updateUniforms('sfondo', 'id_sfondo2')">Nome sfondo 2</button>
					<button type="button" onclick="updateUniforms('sfondo', 'id_sfondo3')">Nome sfondo 3</button>
				</fieldset>
			</form>

			<!-- DESCRIZIONE DEL PRODOTTO -->
			<br><br><p class="desc">Progettato da Howard Spark e successivamente adattato dal figlio Tony, il reattore Ark &egrave; un dispositivo costruito per alimentare le Spark Industries prima e la Spark Tower poi. Una sua versione miniaturizzata fu integrata dallo stesso Tony Spark nella sua celeberrima armatura dell'Uomo di Ferro, per alimentare inizialmente l'elettromagnete inserito nel suo petto (utile a mantenterlo in vita) oltre al suddetto esoscheletro e alle sue armi.</p>
			<p class="desc">La replica qui presentata riproduce fedelmente il reattore miniaturizzato visto nella saga cinematografica dei Vendicatori in scala 1:1, ed &egrave; dotata di un'elevata quantit&agrave; di dettagli nonch&eacute; di possibilit&agrave; di personalizzazione. Puoi scegliere infatti il materiale del prodotto, ma anche...</p>
		</div>

		<!-- FOOTER -->
        <footer>
			<a id="torna_su" href="#"><b>TORNA SU</b></a>
			<div id="footer_content">
				<h1>CONTATTACI:</h1>
				<address>
					Turus Davide: <a href="mailto:turus.davide@spes.uniud.it">turus.davide@spes.uniud.it</a><br/>
					Iop Alessandro: <a href="mailto:iop.alessandro@spes.uniud.it">iop.alessandro@spes.uniud.it</a>
				</address>
			</div>
			<p><a href="https://thenounproject.com/mikicon/collection/e-commerce-2/">Logos</a> created by mikicon from <a href="https://thenounproject.com/">the Noun Project</a></p>
        </footer>
    </body>
</html>